const TelegramBot = require('node-telegram-bot-api');
const express = require('express');
const app = express();

if (!process.env.BOT_TOKEN) {
  console.error('ERROR: BOT_TOKEN not found!');
  process.exit(1);
}

const token = process.env.BOT_TOKEN;
const bot = new TelegramBot(token, {polling: true});

console.log('ü§ñ –ë–æ—Ç –ê–Ω–∏–º–∞–¥—Ä—É–≥ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...');

const userProgress = {};

// –í–†–ï–ú–ï–ù–ù–û - –ø–æ–∫–∞ –Ω–µ—Ç –∫–∞—Ä—Ç–∏–Ω–æ–∫, –Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞
const LESSON_IMAGES = {
  lesson1: '', // —Å—é–¥–∞ –≤—Å—Ç–∞–≤–∏–º —Å—Å—ã–ª–∫—É –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç
  lesson2: '', 
  lesson3: ''
};

const mainMenu = {
  reply_markup: {
    keyboard: [
      ['üéì –ù–∞—á–∞—Ç—å —É—Ä–æ–∫', 'üìö –ü—Ä–∏–º–µ—Ä—ã'],
      ['‚≠ê –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å', '‚ùì –ü–æ–º–æ—â—å']
    ],
    resize_keyboard: true
  }
};

const lessonsMenu = {
  reply_markup: {
    keyboard: [
      ['üìù –£—Ä–æ–∫ 1: –ü—Ä—ã–≥–∞—é—â–∏–π —à–∞—Ä–∏–∫'],
      ['üé® –£—Ä–æ–∫ 2: –ë–µ–≥—É—â–∏–π —á–µ–ª–æ–≤–µ—á–µ–∫'],
      ['‚ú® –£—Ä–æ–∫ 3: –õ–µ—Ç–∞—é—â–∞—è –ø—Ç–∏—Ü–∞'],
      ['üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é']
    ],
    resize_keyboard: true
  }
};

bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  const userName = msg.from.first_name || '–¥—Ä—É–≥';
  
  if (!userProgress[chatId]) {
    userProgress[chatId] = {
      lessonsCompleted: [],
      currentLesson: null
    };
  }

  bot.sendMessage(chatId, 
    `–ü—Ä–∏–≤–µ—Ç, ${userName}! –Ø –ê–Ω–∏–º–∞–¥—Ä—É–≥! üé®\n\n–Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ –æ—Å–≤–æ–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é! –í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:`, 
    mainMenu
  );
});

bot.on('message', (msg) => {
  const chatId = msg.chat.id;
  const text = msg.text;
  const userName = msg.from.first_name || '–¥—Ä—É–≥';

  if (text.startsWith('/')) return;

  if (!userProgress[chatId]) {
    userProgress[chatId] = {
      lessonsCompleted: [],
      currentLesson: null
    };
  }

  switch(text) {
    case 'üéì –ù–∞—á–∞—Ç—å —É—Ä–æ–∫':
      bot.sendMessage(chatId, `–í—ã–±–µ—Ä–∏ —É—Ä–æ–∫:`, lessonsMenu);
      break;

    case 'üìù –£—Ä–æ–∫ 1: –ü—Ä—ã–≥–∞—é—â–∏–π —à–∞—Ä–∏–∫':
      userProgress[chatId].currentLesson = 'lesson1';
      
      const lesson1Text = `üéæ **–£–†–û–ö 1: –ü–†–´–ì–ê–Æ–©–ò–ô –®–ê–†–ò–ö**\n\n` +
                         `*–û—Å–Ω–æ–≤—ã –∞–Ω–∏–º–∞—Ü–∏–∏:*\n\n` +
                         `üìñ *–ü—Ä–∏–Ω—Ü–∏–ø —Å–∂–∞—Ç–∏—è –∏ —Ä–∞—Å—Ç—è–∂–µ–Ω–∏—è:*\n` +
                         `- –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —à–∞—Ä–∏–∫ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è\n` +
                         `- –ü—Ä–∏ —É–¥–∞—Ä–µ –æ –∑–µ–º–ª—é - —Å–∂–∏–º–∞–µ—Ç—Å—è\n` +
                         `- –ü—Ä–∏ –æ—Ç—Å–∫–æ–∫–µ - —Å–Ω–æ–≤–∞ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è\n\n` +
                         `üéØ *–¢–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ:*\n` +
                         `–ù–∞—Ä–∏—Å—É–π 8 –∫–∞–¥—Ä–æ–≤ –ø—Ä—ã–≥–∞—é—â–µ–≥–æ —à–∞—Ä–∏–∫–∞:\n\n` +
                         `1. –®–∞—Ä–∏–∫ –≤–≤–µ—Ä—Ö—É (–∫—Ä—É–≥–ª—ã–π)\n` +
                         `2. –ù–∞—á–∏–Ω–∞–µ—Ç –ø–∞–¥–∞—Ç—å (–Ω–µ–º–Ω–æ–≥–æ —Ä–∞—Å—Ç—è–Ω—É—Ç)\n` +
                         `3. –ë—ã—Å—Ç—Ä–æ –ª–µ—Ç–∏—Ç –≤–Ω–∏–∑ (—Å–∏–ª—å–Ω–æ —Ä–∞—Å—Ç—è–Ω—É—Ç)\n` +
                         `4. –£–¥–∞—Ä –æ –∑–µ–º–ª—é (—Å–ø–ª—é—Å–Ω—É—Ç—ã–π)\n` +
                         `5. –ù–∞—á–∏–Ω–∞–µ—Ç –æ—Ç—Å–∫–∞–∫–∏–≤–∞—Ç—å (—Ä–∞—Å—Ç—è–Ω—É—Ç)\n` +
                         `6. –ë—ã—Å—Ç—Ä–æ –ª–µ—Ç–∏—Ç –≤–≤–µ—Ä—Ö (—Ä–∞—Å—Ç—è–Ω—É—Ç)\n` +
                         `7. –ó–∞–º–µ–¥–ª—è–µ—Ç—Å—è (–º–µ–Ω–µ–µ —Ä–∞—Å—Ç—è–Ω—É—Ç)\n` +
                         `8. –í –≤–µ—Ä—Ö–Ω–µ–π —Ç–æ—á–∫–µ (–∫—Ä—É–≥–ª—ã–π)\n\n` +
                         `üí° *–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–æ–≤–µ—Ç:*\n` +
                         `- –ö–∞–¥—Ä—ã –≤–Ω–∏–∑—É —Ä–∞—Å–ø–æ–ª–∞–≥–∞–π –±–ª–∏–∂–µ –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É (–±—ã—Å—Ç—Ä–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ)\n` +
                         `- –ö–∞–¥—Ä—ã –≤–≤–µ—Ä—Ö—É - –¥–∞–ª—å—à–µ (–º–µ–¥–ª–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ)\n\n` +
                         `–ü—Ä–∏—Å—ã–ª–∞–π —Å–≤–æ–∏ –∫–∞–¥—Ä—ã! üé®`;
      
      bot.sendMessage(chatId, lesson1Text, mainMenu);
      break;

    case 'üé® –£—Ä–æ–∫ 2: –ë–µ–≥—É—â–∏–π —á–µ–ª–æ–≤–µ—á–µ–∫':
      userProgress[chatId].currentLesson = 'lesson2';
      
      const lesson2Text = `üèÉ‚Äç‚ôÇÔ∏è **–£–†–û–ö 2: –ë–ï–ì–£–©–ò–ô –ß–ï–õ–û–í–ï–ß–ï–ö**\n\n` +
                         `*–ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π:*\n\n` +
                         `üìñ *–¶–∏–∫–ª –±–µ–≥–∞:*\n` +
                         `- –î–≤–∏–∂–µ–Ω–∏–µ —Ä—É–∫ –∏ –Ω–æ–≥ –≤ –ø—Ä–æ—Ç–∏–≤–æ—Ñ–∞–∑–µ\n` +
                         `- –¢–µ–ª–æ –Ω–µ–º–Ω–æ–≥–æ –Ω–∞–∫–ª–æ–Ω—è–µ—Ç—Å—è –≤–ø–µ—Ä–µ–¥\n` +
                         `- –ì–æ–ª–æ–≤–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–Ω–æ–π –≤—ã—Å–æ—Ç–µ\n\n` +
                         `üéØ *–¢–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ:*\n` +
                         `–ù–∞—Ä–∏—Å—É–π 6 –∫–∞–¥—Ä–æ–≤ –±–µ–≥—É—â–µ–≥–æ —á–µ–ª–æ–≤–µ—á–∫–∞:\n\n` +
                         `1. –ö–æ–Ω—Ç–∞–∫—Ç (–Ω–æ–≥–∞ –∫–∞—Å–∞–µ—Ç—Å—è –∑–µ–º–ª–∏)\n` +
                         `2. –ù–∏–∑—à–∞—è —Ç–æ—á–∫–∞ (–Ω–æ–≥–∞ —Å–æ–≥–Ω—É—Ç–∞)\n` +
                         `3. –û—Ç—Ä—ã–≤ (–Ω–æ–≥–∞ –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–µ—Ç—Å—è)\n` +
                         `4. –ú–∞—Ö (–Ω–æ–≥–∞ –≤ –≤–æ–∑–¥—É—Ö–µ)\n` +
                         `5. –í—ã—Å—à–∞—è —Ç–æ—á–∫–∞ (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —à–∞–≥—É)\n` +
                         `6. –°–Ω–æ–≤–∞ –∫–æ–Ω—Ç–∞–∫—Ç\n\n` +
                         `üí° *–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–æ–≤–µ—Ç:*\n` +
                         `- –î–æ–±–∞–≤—å –Ω–µ–±–æ–ª—å—à–æ–µ –ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ —Ç–µ–ª–∞\n` +
                         `- –†—É–∫–∏ –¥–≤–∏–≥–∞—é—Ç—Å—è –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ –Ω–æ–≥–∞–º\n\n` +
                         `–ñ–¥—É —Ç–≤–æ–∏ —Ä–∏—Å—É–Ω–∫–∏! üèÉ‚Äç‚ôÇÔ∏è`;
      
      bot.sendMessage(chatId, lesson2Text, mainMenu);
      break;

    case '‚ú® –£—Ä–æ–∫ 3: –õ–µ—Ç–∞—é—â–∞—è –ø—Ç–∏—Ü–∞':
      userProgress[chatId].currentLesson = 'lesson3';
      
      const lesson3Text = `üïäÔ∏è **–£–†–û–ö 3: –õ–ï–¢–ê–Æ–©–ê–Ø –ü–¢–ò–¶–ê**\n\n` +
                         `*–ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è:*\n\n` +
                         `üìñ *–í–æ–ª–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ:*\n` +
                         `- –ö—Ä—ã–ª—å—è –¥–≤–∏–∂—É—Ç—Å—è –ø–æ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ "–≤–æ—Å—å–º–µ—Ä–∫–∏"\n` +
                         `- –¢–µ–ª–æ –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–∏–ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏ –æ–ø—É—Å–∫–∞–µ—Ç—Å—è\n` +
                         `- –•–≤–æ—Å—Ç –ø–æ–º–æ–≥–∞–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª–µ—Ç–æ–º\n\n` +
                         `üéØ *–¢–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ:*\n` +
                         `–ù–∞—Ä–∏—Å—É–π 5 –∫–∞–¥—Ä–æ–≤ –ª–µ—Ç–∞—é—â–µ–π –ø—Ç–∏—Ü—ã:\n\n` +
                         `1. –ö—Ä—ã–ª—å—è –≤–Ω–∏–∑—É (–Ω–∞—á–∞–ª–æ –≤–∑–º–∞—Ö–∞)\n` +
                         `2. –ö—Ä—ã–ª—å—è –≤–ø–µ—Ä–µ–¥ –∏ –≤–≤–µ—Ä—Ö\n` +
                         `3. –ö—Ä—ã–ª—å—è –≤–≤–µ—Ä—Ö—É (–ø–∏–∫ –≤–∑–º–∞—Ö–∞)\n` +
                         `4. –ö—Ä—ã–ª—å—è –Ω–∞–∑–∞–¥ –∏ –≤–Ω–∏–∑\n` +
                         `5. –°–Ω–æ–≤–∞ –≤–Ω–∏–∑—É (–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ü–∏–∫–ª–∞)\n\n` +
                         `üí° *–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–æ–≤–µ—Ç:*\n` +
                         `- –°–¥–µ–ª–∞–π –¥–≤–∏–∂–µ–Ω–∏–µ –ø–ª–∞–≤–Ω—ã–º –∏ —Ü–∏–∫–ª–∏—á–Ω—ã–º\n` +
                         `- –î–æ–±–∞–≤—å –Ω–µ–±–æ–ª—å—à—É—é –∞–º–ø–ª–∏—Ç—É–¥—É —Ç–µ–ª–∞\n\n` +
                         `–¢—ã —Å–ø—Ä–∞–≤–∏—à—å—Å—è! üïäÔ∏è`;
      
      bot.sendMessage(chatId, lesson3Text, mainMenu);
      break;

    case 'üìö –ü—Ä–∏–º–µ—Ä—ã':
      const examplesText = `üìö **–ü–†–ò–ú–ï–†–´ –ê–ù–ò–ú–ê–¶–ò–ô**\n\n` +
                         `*–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:*\n\n` +
                         `üéæ *–ü—Ä—ã–≥–∞—é—â–∏–π —à–∞—Ä–∏–∫:*\n` +
                         `- –°–∂–∞—Ç–∏–µ –∏ —Ä–∞—Å—Ç—è–∂–µ–Ω–∏–µ\n` +
                         `- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∏ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ\n` +
                         `- –î—É–≥–æ–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ\n\n` +
                         `üèÉ‚Äç‚ôÇÔ∏è *–ë–µ–≥—É—â–∏–π —á–µ–ª–æ–≤–µ—á–µ–∫:*\n` +
                         `- –¶–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ\n` +
                         `- –ü—Ä–æ—Ç–∏–≤–æ—Ñ–∞–∑–Ω–æ—Å—Ç—å —Ä—É–∫ –∏ –Ω–æ–≥\n` +
                         `- –í–µ—Å –∏ –±–∞–ª–∞–Ω—Å\n\n` +
                         `üïäÔ∏è *–õ–µ—Ç–∞—é—â–∞—è –ø—Ç–∏—Ü–∞:*\n` +
                         `- –í–æ–ª–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ\n` +
                         `- –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã\n` +
                         `- –ê—ç—Ä–æ–¥–∏–Ω–∞–º–∏–∫–∞\n\n` +
                         `–í—ã–±–∏—Ä–∞–π —É—Ä–æ–∫ –∏ –Ω–∞—á–∏–Ω–∞–π —Ç–≤–æ—Ä–∏—Ç—å! ‚ú®`;
      
      bot.sendMessage(chatId, examplesText, mainMenu);
      break;

    case '‚≠ê –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å':
      const progress = userProgress[chatId];
      const completed = progress.lessonsCompleted.length;
      
      let progressText = `‚≠ê **–¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å, ${userName}:**\n\n` +
                         `‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤: ${completed}/3\n\n`;
      
      if (completed === 0) {
        progressText += `–ù–∞—á–Ω–∏ —Å —É—Ä–æ–∫–∞ 1 - —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ –æ—Å–Ω–æ–≤! üöÄ`;
      } else if (completed === 1) {
        progressText += `–û—Ç–ª–∏—á–Ω–æ! –û—Å–≤–æ–∏–ª —Å–∂–∞—Ç–∏–µ –∏ —Ä–∞—Å—Ç—è–∂–µ–Ω–∏–µ! üí™`;
      } else if (completed === 2) {
        progressText += `–°—É–ø–µ—Ä! –ü–µ—Ä–µ—Ö–æ–¥–∏ –∫ –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏! üåü`;
      } else {
        progressText += `–ü–æ—Ç—Ä—è—Å–∞—é—â–µ! –¢—ã –æ—Å–≤–æ–∏–ª –æ—Å–Ω–æ–≤—ã –∞–Ω–∏–º–∞—Ü–∏–∏! üèÜ`;
      }
      
      bot.sendMessage(chatId, progressText, mainMenu);
      break;

    case '‚ùì –ü–æ–º–æ—â—å':
      const helpText = `‚ùì **–ü–û–ú–û–©–¨**\n\n` +
                       `*–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–æ—Ç–æ–º:*\n\n` +
                       `üéì *–ù–∞—á–∞—Ç—å —É—Ä–æ–∫* - –≤—ã–±–µ—Ä–∏ —É—Ä–æ–∫ –∏ —Å–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º\n` +
                       `üìö *–ü—Ä–∏–º–µ—Ä—ã* - –∏–∑—É—á–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∞–Ω–∏–º–∞—Ü–∏–∏\n` +
                       `‚≠ê *–ü—Ä–æ–≥—Ä–µ—Å—Å* - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π —Å–≤–æ–∏ —É—Å–ø–µ—Ö–∏\n\n` +
                       `*–°–æ–≤–µ—Ç—ã –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö:*\n` +
                       `- –ù–∞—á–∏–Ω–∞–π —Å –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–æ—Ä–º\n` +
                       `- –†–∏—Å—É–π –∫–∞–¥—Ä—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ª–∏—Å—Ç–∞—Ö\n` +
                       `- –°–Ω–∏–º–∞–π –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ —Å–º–æ—Ç—Ä–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n\n` +
                       `–£–¥–∞—á–∏ –≤ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–µ! ü§ó`;
      bot.sendMessage(chatId, helpText, mainMenu);
      break;

    case 'üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é':
      bot.sendMessage(chatId, `–í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é! ‚ú®`, mainMenu);
      break;

    default:
      if (msg.text && !msg.text.startsWith('/')) {
        bot.sendMessage(chatId, `–ò—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é üëá`, mainMenu);
      }
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
bot.on('photo', (msg) => {
  const chatId = msg.chat.id;
  const userName = msg.from.first_name || '–¥—Ä—É–≥';
  const progress = userProgress[chatId];
  
  if (!progress) return;
  
  let response = '';
  
  if (progress.currentLesson === 'lesson1' && !progress.lessonsCompleted.includes(1)) {
    progress.lessonsCompleted.push(1);
    response = `–û—Ç–ª–∏—á–Ω–æ, ${userName}! –¢—ã –æ—Å–≤–æ–∏–ª –ø—Ä–∏–Ω—Ü–∏–ø —Å–∂–∞—Ç–∏—è –∏ —Ä–∞—Å—Ç—è–∂–µ–Ω–∏—è! üéæ\n\n` +
               `–≠—Ç–æ –æ—Å–Ω–æ–≤–∞ –≤—Å–µ–π –∞–Ω–∏–º–∞—Ü–∏–∏ - —Ç–µ–ø–µ—Ä—å —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å, –∫–∞–∫ –æ–∂–∏–≤–ª—è—Ç—å –æ–±—ä–µ–∫—Ç—ã!\n\n` +
               `‚úÖ **–£—Ä–æ–∫ 1 –∑–∞–≤–µ—Ä—à–µ–Ω!**\n\n` +
               `–ü–µ—Ä–µ—Ö–æ–¥–∏ –∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π! üöÄ`;
  }
  else if (progress.currentLesson === 'lesson2' && !progress.lessonsCompleted.includes(2)) {
    progress.lessonsCompleted.push(2);
    response = `–ü–æ—Ç—Ä—è—Å–∞—é—â–µ, ${userName}! –¢—ã –∞–Ω–∏–º–∏—Ä–æ–≤–∞–ª –¥–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞! üèÉ‚Äç‚ôÇÔ∏è\n\n` +
               `–¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è - –∫–ª—é—á –∫ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º –¥–≤–∏–∂–µ–Ω–∏—è–º!\n\n` +
               `‚úÖ **–£—Ä–æ–∫ 2 –∑–∞–≤–µ—Ä—à–µ–Ω!**\n\n` +
               `–¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å! –û—Å—Ç–∞–ª—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–∫! üí™`;
  }
  else if (progress.currentLesson === 'lesson3' && !progress.lessonsCompleted.includes(3)) {
    progress.lessonsCompleted.push(3);
    response = `–í–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–æ, ${userName}! –¢—ã —Å–æ–∑–¥–∞–ª –ø–ª–∞–≤–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ–ª–µ—Ç–∞! üïäÔ∏è\n\n` +
               `–í–æ–ª–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è - –≤—ã—Å—à–∏–π –ø–∏–ª–æ—Ç–∞–∂ –≤ –∞–Ω–∏–º–∞—Ü–∏–∏!\n\n` +
               `‚úÖ **–£—Ä–æ–∫ 3 –∑–∞–≤–µ—Ä—à–µ–Ω!**\n\n` +
               `üéâ **–ü–û–ó–î–†–ê–í–õ–Ø–Æ!** –¢—ã –æ—Å–≤–æ–∏–ª –æ—Å–Ω–æ–≤—ã –∞–Ω–∏–º–∞—Ü–∏–∏! üèÜ`;
  }
  else {
    response = `–ö—Ä—É—Ç–æ–π —Ä–∏—Å—É–Ω–æ–∫, ${userName}! üé®\n\n` +
               `–ü—Ä–æ–¥–æ–ª–∂–∞–π –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å—Å—è - —É —Ç–µ–±—è –æ—Ç–ª–∏—á–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è! ‚ú®`;
  }
  
  bot.sendMessage(chatId, response, mainMenu);
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É ${PORT}`);
});
