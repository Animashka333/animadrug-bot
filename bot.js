const TelegramBot = require('node-telegram-bot-api');
const express = require('express');
const app = express();

if (!process.env.BOT_TOKEN) {
  console.error('ERROR: BOT_TOKEN not found!');
  process.exit(1);
}

const token = process.env.BOT_TOKEN;
const bot = new TelegramBot(token, {polling: true});

console.log('ðŸ¤– Ð‘Ð¾Ñ‚ ÐÐ½Ð¸Ð¼Ð°Ð´Ñ€ÑƒÐ³ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ...');

const userProgress = {};

// Ð’Ð Ð•ÐœÐ•ÐÐÐž - Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ ÐºÐ°Ñ€Ñ‚Ð¸Ð½Ð¾Ðº, Ð½Ð¾ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð³Ð¾Ñ‚Ð¾Ð²Ð°
const LESSON_IMAGES = {
  lesson1: '', // ÑÑŽÐ´Ð° Ð²ÑÑ‚Ð°Ð²Ð¸Ð¼ ÑÑÑ‹Ð»ÐºÑƒ ÐºÐ¾Ð³Ð´Ð° Ð±ÑƒÐ´ÐµÑ‚
  lesson2: '', 
  lesson3: ''
};

const mainMenu = {
  reply_markup: {
    keyboard: [
      ['ðŸŽ“ ÐÐ°Ñ‡Ð°Ñ‚ÑŒ ÑƒÑ€Ð¾Ðº', 'ðŸ“š ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹'],
      ['â­ ÐœÐ¾Ð¹ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ', 'â“ ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ']
    ],
    resize_keyboard: true
  }
};

const lessonsMenu = {
  reply_markup: {
    keyboard: [
      ['ðŸ“ Ð£Ñ€Ð¾Ðº 1: ÐŸÑ€Ñ‹Ð³Ð°ÑŽÑ‰Ð¸Ð¹ ÑˆÐ°Ñ€Ð¸Ðº'],
      ['ðŸŽ¨ Ð£Ñ€Ð¾Ðº 2: Ð‘ÐµÐ³ÑƒÑ‰Ð¸Ð¹ Ñ‡ÐµÐ»Ð¾Ð²ÐµÑ‡ÐµÐº'],
      ['âœ¨ Ð£Ñ€Ð¾Ðº 3: Ð›ÐµÑ‚Ð°ÑŽÑ‰Ð°Ñ Ð¿Ñ‚Ð¸Ñ†Ð°'],
      ['ðŸ”™ ÐÐ°Ð·Ð°Ð´ Ð² Ð¼ÐµÐ½ÑŽ']
    ],
    resize_keyboard: true
  }
};

bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  const userName = msg.from.first_name || 'Ð´Ñ€ÑƒÐ³';
  
  if (!userProgress[chatId]) {
    userProgress[chatId] = {
      lessonsCompleted: [],
      currentLesson: null
    };
  }

  bot.sendMessage(chatId, 
    `ÐŸÑ€Ð¸Ð²ÐµÑ‚, ${userName}! Ð¯ ÐÐ½Ð¸Ð¼Ð°Ð´Ñ€ÑƒÐ³! ðŸŽ¨\n\nÐ¯ Ð¿Ð¾Ð¼Ð¾Ð³Ñƒ Ñ‚ÐµÐ±Ðµ Ð¾ÑÐ²Ð¾Ð¸Ñ‚ÑŒ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸ÑŽ! Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:`, 
    mainMenu
  );
});

bot.on('message', (msg) => {
  const chatId = msg.chat.id;
  const text = msg.text;
  const userName = msg.from.first_name || 'Ð´Ñ€ÑƒÐ³';

  if (text.startsWith('/')) return;

  if (!userProgress[chatId]) {
    userProgress[chatId] = {
      lessonsCompleted: [],
      currentLesson: null
    };
  }

  switch(text) {
    case 'ðŸŽ“ ÐÐ°Ñ‡Ð°Ñ‚ÑŒ ÑƒÑ€Ð¾Ðº':
      bot.sendMessage(chatId, `Ð’Ñ‹Ð±ÐµÑ€Ð¸ ÑƒÑ€Ð¾Ðº:`, lessonsMenu);
      break;

    case 'ðŸ“ Ð£Ñ€Ð¾Ðº 1: ÐŸÑ€Ñ‹Ð³Ð°ÑŽÑ‰Ð¸Ð¹ ÑˆÐ°Ñ€Ð¸Ðº':
      userProgress[chatId].currentLesson = 'lesson1';
      
      const lesson1Text = `ðŸŽ¾ **Ð£Ð ÐžÐš 1: ÐŸÐ Ð«Ð“ÐÐ®Ð©Ð˜Ð™ Ð¨ÐÐ Ð˜Ðš**\n\n` +
                         `*ÐžÑÐ½Ð¾Ð²Ñ‹ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸:*\n\n` +
                         `ðŸ“– *ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿ ÑÐ¶Ð°Ñ‚Ð¸Ñ Ð¸ Ñ€Ð°ÑÑ‚ÑÐ¶ÐµÐ½Ð¸Ñ:*\n` +
                         `- ÐŸÑ€Ð¸ Ð¿Ð°Ð´ÐµÐ½Ð¸Ð¸ ÑˆÐ°Ñ€Ð¸Ðº Ñ€Ð°ÑÑ‚ÑÐ³Ð¸Ð²Ð°ÐµÑ‚ÑÑ\n` +
                         `- ÐŸÑ€Ð¸ ÑƒÐ´Ð°Ñ€Ðµ Ð¾ Ð·ÐµÐ¼Ð»ÑŽ - ÑÐ¶Ð¸Ð¼Ð°ÐµÑ‚ÑÑ\n` +
                         `- ÐŸÑ€Ð¸ Ð¾Ñ‚ÑÐºÐ¾ÐºÐµ - ÑÐ½Ð¾Ð²Ð° Ñ€Ð°ÑÑ‚ÑÐ³Ð¸Ð²Ð°ÐµÑ‚ÑÑ\n\n` +
                         `ðŸŽ¯ *Ð¢Ð²Ð¾Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ:*\n` +
                         `ÐÐ°Ñ€Ð¸ÑÑƒÐ¹ 8 ÐºÐ°Ð´Ñ€Ð¾Ð² Ð¿Ñ€Ñ‹Ð³Ð°ÑŽÑ‰ÐµÐ³Ð¾ ÑˆÐ°Ñ€Ð¸ÐºÐ°:\n\n` +
                         `1. Ð¨Ð°Ñ€Ð¸Ðº Ð²Ð²ÐµÑ€Ñ…Ñƒ (ÐºÑ€ÑƒÐ³Ð»Ñ‹Ð¹)\n` +
                         `2. ÐÐ°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ Ð¿Ð°Ð´Ð°Ñ‚ÑŒ (Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ñ€Ð°ÑÑ‚ÑÐ½ÑƒÑ‚)\n` +
                         `3. Ð‘Ñ‹ÑÑ‚Ñ€Ð¾ Ð»ÐµÑ‚Ð¸Ñ‚ Ð²Ð½Ð¸Ð· (ÑÐ¸Ð»ÑŒÐ½Ð¾ Ñ€Ð°ÑÑ‚ÑÐ½ÑƒÑ‚)\n` +
                         `4. Ð£Ð´Ð°Ñ€ Ð¾ Ð·ÐµÐ¼Ð»ÑŽ (ÑÐ¿Ð»ÑŽÑÐ½ÑƒÑ‚Ñ‹Ð¹)\n` +
                         `5. ÐÐ°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ Ð¾Ñ‚ÑÐºÐ°ÐºÐ¸Ð²Ð°Ñ‚ÑŒ (Ñ€Ð°ÑÑ‚ÑÐ½ÑƒÑ‚)\n` +
                         `6. Ð‘Ñ‹ÑÑ‚Ñ€Ð¾ Ð»ÐµÑ‚Ð¸Ñ‚ Ð²Ð²ÐµÑ€Ñ… (Ñ€Ð°ÑÑ‚ÑÐ½ÑƒÑ‚)\n` +
                         `7. Ð—Ð°Ð¼ÐµÐ´Ð»ÑÐµÑ‚ÑÑ (Ð¼ÐµÐ½ÐµÐµ Ñ€Ð°ÑÑ‚ÑÐ½ÑƒÑ‚)\n` +
                         `8. Ð’ Ð²ÐµÑ€Ñ…Ð½ÐµÐ¹ Ñ‚Ð¾Ñ‡ÐºÐµ (ÐºÑ€ÑƒÐ³Ð»Ñ‹Ð¹)\n\n` +
                         `ðŸ’¡ *ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ¾Ð²ÐµÑ‚:*\n` +
                         `- ÐšÐ°Ð´Ñ€Ñ‹ Ð²Ð½Ð¸Ð·Ñƒ Ñ€Ð°ÑÐ¿Ð¾Ð»Ð°Ð³Ð°Ð¹ Ð±Ð»Ð¸Ð¶Ðµ Ð´Ñ€ÑƒÐ³ Ðº Ð´Ñ€ÑƒÐ³Ñƒ (Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ðµ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ)\n` +
                         `- ÐšÐ°Ð´Ñ€Ñ‹ Ð²Ð²ÐµÑ€Ñ…Ñƒ - Ð´Ð°Ð»ÑŒÑˆÐµ (Ð¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾Ðµ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ)\n\n` +
                         `ÐŸÑ€Ð¸ÑÑ‹Ð»Ð°Ð¹ ÑÐ²Ð¾Ð¸ ÐºÐ°Ð´Ñ€Ñ‹! ðŸŽ¨`;
      
      bot.sendMessage(chatId, lesson1Text, mainMenu);
      break;

    case 'ðŸŽ¨ Ð£Ñ€Ð¾Ðº 2: Ð‘ÐµÐ³ÑƒÑ‰Ð¸Ð¹ Ñ‡ÐµÐ»Ð¾Ð²ÐµÑ‡ÐµÐº':
      userProgress[chatId].currentLesson = 'lesson2';
      
      const lesson2Text = `ðŸƒâ€â™‚ï¸ **Ð£Ð ÐžÐš 2: Ð‘Ð•Ð“Ð£Ð©Ð˜Ð™ Ð§Ð•Ð›ÐžÐ’Ð•Ð§Ð•Ðš**\n\n` +
                         `*ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð¶ÐµÐ¹:*\n\n` +
                         `ðŸ“– *Ð¦Ð¸ÐºÐ» Ð±ÐµÐ³Ð°:*\n` +
                         `- Ð”Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ñ€ÑƒÐº Ð¸ Ð½Ð¾Ð³ Ð² Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²Ð¾Ñ„Ð°Ð·Ðµ\n` +
                         `- Ð¢ÐµÐ»Ð¾ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð½Ð°ÐºÐ»Ð¾Ð½ÑÐµÑ‚ÑÑ Ð²Ð¿ÐµÑ€ÐµÐ´\n` +
                         `- Ð“Ð¾Ð»Ð¾Ð²Ð° Ð¾ÑÑ‚Ð°ÐµÑ‚ÑÑ Ð½Ð° Ð¾Ð´Ð½Ð¾Ð¹ Ð²Ñ‹ÑÐ¾Ñ‚Ðµ\n\n` +
                         `ðŸŽ¯ *Ð¢Ð²Ð¾Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ:*\n` +
                         `ÐÐ°Ñ€Ð¸ÑÑƒÐ¹ 6 ÐºÐ°Ð´Ñ€Ð¾Ð² Ð±ÐµÐ³ÑƒÑ‰ÐµÐ³Ð¾ Ñ‡ÐµÐ»Ð¾Ð²ÐµÑ‡ÐºÐ°:\n\n` +
                         `1. ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚ (Ð½Ð¾Ð³Ð° ÐºÐ°ÑÐ°ÐµÑ‚ÑÑ Ð·ÐµÐ¼Ð»Ð¸)\n` +
                         `2. ÐÐ¸Ð·ÑˆÐ°Ñ Ñ‚Ð¾Ñ‡ÐºÐ° (Ð½Ð¾Ð³Ð° ÑÐ¾Ð³Ð½ÑƒÑ‚Ð°)\n` +
                         `3. ÐžÑ‚Ñ€Ñ‹Ð² (Ð½Ð¾Ð³Ð° Ð¾Ñ‚Ñ‚Ð°Ð»ÐºÐ¸Ð²Ð°ÐµÑ‚ÑÑ)\n` +
                         `4. ÐœÐ°Ñ… (Ð½Ð¾Ð³Ð° Ð² Ð²Ð¾Ð·Ð´ÑƒÑ…Ðµ)\n` +
                         `5. Ð’Ñ‹ÑÑˆÐ°Ñ Ñ‚Ð¾Ñ‡ÐºÐ° (Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ðº ÑˆÐ°Ð³Ñƒ)\n` +
                         `6. Ð¡Ð½Ð¾Ð²Ð° ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚\n\n` +
                         `ðŸ’¡ *ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ¾Ð²ÐµÑ‚:*\n` +
                         `- Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð¿Ð¾Ð´Ð¿Ñ€Ñ‹Ð³Ð¸Ð²Ð°Ð½Ð¸Ðµ Ñ‚ÐµÐ»Ð°\n` +
                         `- Ð ÑƒÐºÐ¸ Ð´Ð²Ð¸Ð³Ð°ÑŽÑ‚ÑÑ Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²Ð¾Ð¿Ð¾Ð»Ð¾Ð¶Ð½Ð¾ Ð½Ð¾Ð³Ð°Ð¼\n\n` +
                         `Ð–Ð´Ñƒ Ñ‚Ð²Ð¾Ð¸ Ñ€Ð¸ÑÑƒÐ½ÐºÐ¸! ðŸƒâ€â™‚ï¸`;
      
      bot.sendMessage(chatId, lesson2Text, mainMenu);
      break;

    case 'âœ¨ Ð£Ñ€Ð¾Ðº 3: Ð›ÐµÑ‚Ð°ÑŽÑ‰Ð°Ñ Ð¿Ñ‚Ð¸Ñ†Ð°':
      userProgress[chatId].currentLesson = 'lesson3';
      
      const lesson3Text = `ðŸ•Šï¸ **Ð£Ð ÐžÐš 3: Ð›Ð•Ð¢ÐÐ®Ð©ÐÐ¯ ÐŸÐ¢Ð˜Ð¦Ð**\n\n` +
                         `*ÐŸÐ»Ð°Ð²Ð½Ð°Ñ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ñ:*\n\n` +
                         `ðŸ“– *Ð’Ð¾Ð»Ð½Ð¾Ð¾Ð±Ñ€Ð°Ð·Ð½Ð¾Ðµ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ:*\n` +
                         `- ÐšÑ€Ñ‹Ð»ÑŒÑ Ð´Ð²Ð¸Ð¶ÑƒÑ‚ÑÑ Ð¿Ð¾ Ñ‚Ñ€Ð°ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ "Ð²Ð¾ÑÑŒÐ¼ÐµÑ€ÐºÐ¸"\n` +
                         `- Ð¢ÐµÐ»Ð¾ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¸Ð¿Ð¾Ð´Ð½Ð¸Ð¼Ð°ÐµÑ‚ÑÑ Ð¸ Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ\n` +
                         `- Ð¥Ð²Ð¾ÑÑ‚ Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ð¿Ð¾Ð»ÐµÑ‚Ð¾Ð¼\n\n` +
                         `ðŸŽ¯ *Ð¢Ð²Ð¾Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ:*\n` +
                         `ÐÐ°Ñ€Ð¸ÑÑƒÐ¹ 5 ÐºÐ°Ð´Ñ€Ð¾Ð² Ð»ÐµÑ‚Ð°ÑŽÑ‰ÐµÐ¹ Ð¿Ñ‚Ð¸Ñ†Ñ‹:\n\n` +
                         `1. ÐšÑ€Ñ‹Ð»ÑŒÑ Ð²Ð½Ð¸Ð·Ñƒ (Ð½Ð°Ñ‡Ð°Ð»Ð¾ Ð²Ð·Ð¼Ð°Ñ…Ð°)\n` +
                         `2. ÐšÑ€Ñ‹Ð»ÑŒÑ Ð²Ð¿ÐµÑ€ÐµÐ´ Ð¸ Ð²Ð²ÐµÑ€Ñ…\n` +
                         `3. ÐšÑ€Ñ‹Ð»ÑŒÑ Ð²Ð²ÐµÑ€Ñ…Ñƒ (Ð¿Ð¸Ðº Ð²Ð·Ð¼Ð°Ñ…Ð°)\n` +
                         `4. ÐšÑ€Ñ‹Ð»ÑŒÑ Ð½Ð°Ð·Ð°Ð´ Ð¸ Ð²Ð½Ð¸Ð·\n` +
                         `5. Ð¡Ð½Ð¾Ð²Ð° Ð²Ð½Ð¸Ð·Ñƒ (Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ñ†Ð¸ÐºÐ»Ð°)\n\n` +
                         `ðŸ’¡ *ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ¾Ð²ÐµÑ‚:*\n` +
                         `- Ð¡Ð´ÐµÐ»Ð°Ð¹ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð»Ð°Ð²Ð½Ñ‹Ð¼ Ð¸ Ñ†Ð¸ÐºÐ»Ð¸Ñ‡Ð½Ñ‹Ð¼\n` +
                         `- Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÑƒÑŽ Ð°Ð¼Ð¿Ð»Ð¸Ñ‚ÑƒÐ´Ñƒ Ñ‚ÐµÐ»Ð°\n\n` +
                         `Ð¢Ñ‹ ÑÐ¿Ñ€Ð°Ð²Ð¸ÑˆÑŒÑÑ! ðŸ•Šï¸`;
      
      bot.sendMessage(chatId, lesson3Text, mainMenu);
      break;

    case 'ðŸ“š ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹':
      const examplesText = `ðŸ“š **ÐŸÐ Ð˜ÐœÐ•Ð Ð« ÐÐÐ˜ÐœÐÐ¦Ð˜Ð™**\n\n` +
                         `*ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹:*\n\n` +
                         `ðŸŽ¾ *ÐŸÑ€Ñ‹Ð³Ð°ÑŽÑ‰Ð¸Ð¹ ÑˆÐ°Ñ€Ð¸Ðº:*\n` +
                         `- Ð¡Ð¶Ð°Ñ‚Ð¸Ðµ Ð¸ Ñ€Ð°ÑÑ‚ÑÐ¶ÐµÐ½Ð¸Ðµ\n` +
                         `- Ð£ÑÐºÐ¾Ñ€ÐµÐ½Ð¸Ðµ Ð¸ Ð·Ð°Ð¼ÐµÐ´Ð»ÐµÐ½Ð¸Ðµ\n` +
                         `- Ð”ÑƒÐ³Ð¾Ð²Ð¾Ðµ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ\n\n` +
                         `ðŸƒâ€â™‚ï¸ *Ð‘ÐµÐ³ÑƒÑ‰Ð¸Ð¹ Ñ‡ÐµÐ»Ð¾Ð²ÐµÑ‡ÐµÐº:*\n` +
                         `- Ð¦Ð¸ÐºÐ»Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ\n` +
                         `- ÐŸÑ€Ð¾Ñ‚Ð¸Ð²Ð¾Ñ„Ð°Ð·Ð½Ð¾ÑÑ‚ÑŒ Ñ€ÑƒÐº Ð¸ Ð½Ð¾Ð³\n` +
                         `- Ð’ÐµÑ Ð¸ Ð±Ð°Ð»Ð°Ð½Ñ\n\n` +
                         `ðŸ•Šï¸ *Ð›ÐµÑ‚Ð°ÑŽÑ‰Ð°Ñ Ð¿Ñ‚Ð¸Ñ†Ð°:*\n` +
                         `- Ð’Ð¾Ð»Ð½Ð¾Ð¾Ð±Ñ€Ð°Ð·Ð½Ð¾Ðµ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ\n` +
                         `- ÐŸÐ»Ð°Ð²Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ñ‹\n` +
                         `- ÐÑÑ€Ð¾Ð´Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ°\n\n` +
                         `Ð’Ñ‹Ð±Ð¸Ñ€Ð°Ð¹ ÑƒÑ€Ð¾Ðº Ð¸ Ð½Ð°Ñ‡Ð¸Ð½Ð°Ð¹ Ñ‚Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ! âœ¨`;
      
      bot.sendMessage(chatId, examplesText, mainMenu);
      break;

    case 'â­ ÐœÐ¾Ð¹ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ':
      const progress = userProgress[chatId];
      const completed = progress.lessonsCompleted.length;
      
      let progressText = `â­ **Ð¢Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ, ${userName}:**\n\n` +
                         `âœ… ÐŸÑ€Ð¾Ð¹Ð´ÐµÐ½Ð¾ ÑƒÑ€Ð¾ÐºÐ¾Ð²: ${completed}/3\n\n`;
      
      if (completed === 0) {
        progressText += `ÐÐ°Ñ‡Ð½Ð¸ Ñ ÑƒÑ€Ð¾ÐºÐ° 1 - ÑÑ‚Ð¾ Ð¾ÑÐ½Ð¾Ð²Ð° Ð¾ÑÐ½Ð¾Ð²! ðŸš€`;
      } else if (completed === 1) {
        progressText += `ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾! ÐžÑÐ²Ð¾Ð¸Ð» ÑÐ¶Ð°Ñ‚Ð¸Ðµ Ð¸ Ñ€Ð°ÑÑ‚ÑÐ¶ÐµÐ½Ð¸Ðµ! ðŸ’ª`;
      } else if (completed === 2) {
        progressText += `Ð¡ÑƒÐ¿ÐµÑ€! ÐŸÐµÑ€ÐµÑ…Ð¾Ð´Ð¸ Ðº Ð¿Ð»Ð°Ð²Ð½Ð¾Ð¹ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸! ðŸŒŸ`;
      } else {
        progressText += `ÐŸÐ¾Ñ‚Ñ€ÑÑÐ°ÑŽÑ‰Ðµ! Ð¢Ñ‹ Ð¾ÑÐ²Ð¾Ð¸Ð» Ð¾ÑÐ½Ð¾Ð²Ñ‹ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸! ðŸ†`;
      }
      
      bot.sendMessage(chatId, progressText, mainMenu);
      break;

    case 'â“ ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ':
      const helpText = `â“ **ÐŸÐžÐœÐžÐ©Ð¬**\n\n` +
                       `*ÐšÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ñ Ð±Ð¾Ñ‚Ð¾Ð¼:*\n\n` +
                       `ðŸŽ“ *ÐÐ°Ñ‡Ð°Ñ‚ÑŒ ÑƒÑ€Ð¾Ðº* - Ð²Ñ‹Ð±ÐµÑ€Ð¸ ÑƒÑ€Ð¾Ðº Ð¸ ÑÐ»ÐµÐ´ÑƒÐ¹ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑÐ¼\n` +
                       `ðŸ“š *ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹* - Ð¸Ð·ÑƒÑ‡Ð¸ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸\n` +
                       `â­ *ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ* - Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð¹ ÑÐ²Ð¾Ð¸ ÑƒÑÐ¿ÐµÑ…Ð¸\n\n` +
                       `*Ð¡Ð¾Ð²ÐµÑ‚Ñ‹ Ð´Ð»Ñ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ñ…:*\n` +
                       `- ÐÐ°Ñ‡Ð¸Ð½Ð°Ð¹ Ñ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ñ… Ñ„Ð¾Ñ€Ð¼\n` +
                       `- Ð Ð¸ÑÑƒÐ¹ ÐºÐ°Ð´Ñ€Ñ‹ Ð½Ð° Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð»Ð¸ÑÑ‚Ð°Ñ…\n` +
                       `- Ð¡Ð½Ð¸Ð¼Ð°Ð¹ Ð½Ð° Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½ Ð¸ ÑÐ¼Ð¾Ñ‚Ñ€Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚\n\n` +
                       `Ð£Ð´Ð°Ñ‡Ð¸ Ð² Ñ‚Ð²Ð¾Ñ€Ñ‡ÐµÑÑ‚Ð²Ðµ! ðŸ¤—`;
      bot.sendMessage(chatId, helpText, mainMenu);
      break;

    case 'ðŸ”™ ÐÐ°Ð·Ð°Ð´ Ð² Ð¼ÐµÐ½ÑŽ':
      bot.sendMessage(chatId, `Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ÑÑ Ð² Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ! âœ¨`, mainMenu);
      break;

    default:
      if (msg.text && !msg.text.startsWith('/')) {
        bot.sendMessage(chatId, `Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¼ÐµÐ½ÑŽ ðŸ‘‡`, mainMenu);
      }
  }
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ñ„Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ð¸Ð¹
bot.on('photo', (msg) => {
  const chatId = msg.chat.id;
  const userName = msg.from.first_name || 'Ð´Ñ€ÑƒÐ³';
  const progress = userProgress[chatId];
  
  if (!progress) return;
  
  let response = '';
  
  if (progress.currentLesson === 'lesson1' && !progress.lessonsCompleted.includes(1)) {
    progress.lessonsCompleted.push(1);
    response = `ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾, ${userName}! Ð¢Ñ‹ Ð¾ÑÐ²Ð¾Ð¸Ð» Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿ ÑÐ¶Ð°Ñ‚Ð¸Ñ Ð¸ Ñ€Ð°ÑÑ‚ÑÐ¶ÐµÐ½Ð¸Ñ! ðŸŽ¾\n\n` +
               `Ð­Ñ‚Ð¾ Ð¾ÑÐ½Ð¾Ð²Ð° Ð²ÑÐµÐ¹ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸ - Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ñ‚Ñ‹ Ð¿Ð¾Ð½Ð¸Ð¼Ð°ÐµÑˆÑŒ, ÐºÐ°Ðº Ð¾Ð¶Ð¸Ð²Ð»ÑÑ‚ÑŒ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹!\n\n` +
               `âœ… **Ð£Ñ€Ð¾Ðº 1 Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½!**\n\n` +
               `ÐŸÐµÑ€ÐµÑ…Ð¾Ð´Ð¸ Ðº Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð¶ÐµÐ¹! ðŸš€`;
  }
  else if (progress.currentLesson === 'lesson2' && !progress.lessonsCompleted.includes(2)) {
    progress.lessonsCompleted.push(2);
    response = `ÐŸÐ¾Ñ‚Ñ€ÑÑÐ°ÑŽÑ‰Ðµ, ${userName}! Ð¢Ñ‹ Ð°Ð½Ð¸Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð» Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð¶Ð°! ðŸƒâ€â™‚ï¸\n\n` +
               `Ð¦Ð¸ÐºÐ»Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ñ - ÐºÐ»ÑŽÑ‡ Ðº Ñ€ÐµÐ°Ð»Ð¸ÑÑ‚Ð¸Ñ‡Ð½Ñ‹Ð¼ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸ÑÐ¼!\n\n` +
               `âœ… **Ð£Ñ€Ð¾Ðº 2 Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½!**\n\n` +
               `Ð¢Ð°Ðº Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ! ÐžÑÑ‚Ð°Ð»ÑÑ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ ÑƒÑ€Ð¾Ðº! ðŸ’ª`;
  }
  else if (progress.currentLesson === 'lesson3' && !progress.lessonsCompleted.includes(3)) {
    progress.lessonsCompleted.push(3);
    response = `Ð’Ð¾ÑÑ…Ð¸Ñ‚Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾, ${userName}! Ð¢Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð» Ð¿Ð»Ð°Ð²Ð½ÑƒÑŽ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸ÑŽ Ð¿Ð¾Ð»ÐµÑ‚Ð°! ðŸ•Šï¸\n\n` +
               `Ð’Ð¾Ð»Ð½Ð¾Ð¾Ð±Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ - Ð²Ñ‹ÑÑˆÐ¸Ð¹ Ð¿Ð¸Ð»Ð¾Ñ‚Ð°Ð¶ Ð² Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸!\n\n` +
               `âœ… **Ð£Ñ€Ð¾Ðº 3 Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½!**\n\n` +
               `ðŸŽ‰ **ÐŸÐžÐ—Ð”Ð ÐÐ’Ð›Ð¯Ð®!** Ð¢Ñ‹ Ð¾ÑÐ²Ð¾Ð¸Ð» Ð¾ÑÐ½Ð¾Ð²Ñ‹ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸! ðŸ†`;
  }
  else {
    response = `ÐšÑ€ÑƒÑ‚Ð¾Ð¹ Ñ€Ð¸ÑÑƒÐ½Ð¾Ðº, ${userName}! ðŸŽ¨\n\n` +
               `ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð¹ Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ¾Ð²Ð°Ñ‚ÑŒÑÑ - Ñƒ Ñ‚ÐµÐ±Ñ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ÑÑ! âœ¨`;
  }
  
  bot.sendMessage(chatId, response, mainMenu);
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`âœ… Ð‘Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ ${PORT}`);
});
